import React, { useEffect, useState } from 'react';
import { useDispatch, useSelector } from "react-redux";
import { Box, Container, Typography, TextField, Grid, MenuItem, Button, Select, } from '@mui/material';
import './Home.css'
import Pagination from '../Paginate/Paginate';
<<<<<<< HEAD
import { obtener_Todos_Libros, obtenerGeneros, obtenerAutores, filterByOrigin, filterByGenre, filterByAuthor, orderByPrice, orderByName, } from '../../redux/actions/actions';
=======
import { obtener_Todos_Libros , librosGenero, librosPorTitulo} from '../../redux/actions/actions';
import NavBar from '../Nav/Nav';
>>>>>>> aad8582fcf1e22130e9adf4e3becb76bafdeb7d3
import Cardsw from '../Cards/Cardsw';
import Footer from './../Footer/Footer';

const Home = () => {
<<<<<<< HEAD
  const dispatch = useDispatch();
  const todoLibros = useSelector((state) => state.libros);
  const [libros, setLibros] = useState([]);
  const [currentPage, setCurrentPage] = useState(1);
  const librosPorPagina = 12;
  const [totalLibros, setTotalLibros] = useState();

  const indexOfLastBook = currentPage * librosPorPagina;
  const indexOfFirstBook = indexOfLastBook - librosPorPagina;
  const currentBooks = Array.isArray(libros) ? libros.slice(indexOfFirstBook, indexOfLastBook) : [];

  const todoGeneros = useSelector((state)=>state.genero);
  const autores = useSelector((state)=>state.autor);

  const [order, setOrder] = useState('');

  
  useEffect(() => {
    dispatch(obtener_Todos_Libros(currentPage, librosPorPagina));
    obtenerGeneros(dispatch);
    obtenerAutores(dispatch);
  }, [currentPage, dispatch]);
  

  useEffect(() => {
    if (todoLibros && todoLibros.libros) {
      setLibros(todoLibros.libros);
      setTotalLibros(todoLibros.totalLibros);
    }
  }, [todoLibros]);

  const handlePageChange = (pageNumber) => {
    console.log("pageNumber ", pageNumber);
    setCurrentPage(pageNumber);
  };

  // alfabeticamente
  function handleSort(e){
    e.preventDefault();
    dispatch(orderByName(e.target.value));
    setOrder(`Alphabetical ${e.target.value} order`);
    setCurrentPage(1);
    e.target.value= 'default';
  }  

  // precio
  function handlePriceSort(e) {
    e.preventDefault();
    dispatch(orderByPrice(e.target.value)); 
    setOrder(`Price ${e.target.value} order`);
    setCurrentPage(1);
    e.target.value = 'default';
  }

  // genero
  function handleFilterGenre(e) {
    e.preventDefault();
    dispatch(filterByGenre(e.target.value)); 
    setOrder(`Filtered by Gender: ${e.target.value}`);
    e.target.value = 'default';
  }

  //autor
  function handleFilterAuthor(e) {
    e.preventDefault();
    dispatch(filterByAuthor(e.target.value)); 
    setOrder(`Filtered by Author: ${e.target.value}`);
    e.target.value = 'default';
  }

  //base de datos y nuevos
  function handleFilterByOrigin(e){
    e.preventDefault();
    dispatch(filterByOrigin(e.target.value));
    setOrder(`Filtered by Origin: ${e.target.value}`);
    e.target.value= 'default';
  }

  //limpiar filtros
  function handleClearFilters() {
      handleSort({ target: { value: 'default' } });
      handlePriceSort({ target: { value: 'default' } });
      handleFilterGenre({ target: { value: 'default' } });
      handleFilterAuthor({ target: { value: 'default' } });
      handleFilterByOrigin({ target: { value: 'default' } });
    }


    return (
      <Container component="main" maxWidth="100%">
        <Box sx={{ mt: 10 }}>
          <Typography variant="h2" align="center" gutterBottom>
            Lista de Libros
          </Typography>
        </Box>
        <Box sx={{ display: 'flex', mb: 10}}>
    <Box>
      <Select sx={{ minWidth: 200, mr: 5, }} className="homeFilters" value='default' onChange={e => handleSort(e)}>
        <MenuItem disabled value="default">Órden por nombre...</MenuItem>
        <MenuItem value="asc">A - Z</MenuItem>
        <MenuItem value="desc">Z - A</MenuItem>
      </Select>
    </Box>
  <Box>
    <Select sx={{ minWidth: 200, mr: 5,  }} className="homeFilters" value='default' onChange={e => handlePriceSort(e)}>
      <MenuItem disabled value="default">Precio...</MenuItem>
      <MenuItem value="asc">Menor a Mayor</MenuItem>
      <MenuItem value="desc">Mayor a Menor</MenuItem>
    </Select>
  </Box>
  <Box>
    <Select sx={{ minWidth: 200, mr: 5,  }} className="homeFilters" value='default' onChange={e => handleFilterGenre(e)}>
      <MenuItem disabled value="default">Género...</MenuItem>
      <MenuItem value='all'>Todos</MenuItem>
      <MenuItem value='male'>Male</MenuItem>
      <MenuItem value='female'>Female</MenuItem>
    </Select>
  </Box>
  <Box>
    <Select sx={{ minWidth: 200, mr: 5,  }} className="homeFilters" value='default' onChange={e => handleFilterAuthor(e)}>
      <MenuItem disabled value="default">Autor/a...</MenuItem>
      <MenuItem value='all'>Todos/as</MenuItem>
      <MenuItem value='author1'>Author 1</MenuItem>
      <MenuItem value='author2'>Author 2</MenuItem>
    </Select>
  </Box>
  <Box>
    <Select sx={{ minWidth: 200, mr: 5,  }} className="homeFilters" value='default' onChange={e => handleFilterByOrigin(e)}>
      <MenuItem disabled value="default">Origen...</MenuItem>
      <MenuItem value="all">Todos los libros...</MenuItem>
      <MenuItem value="originals">Originales...</MenuItem>
      <MenuItem value="created by User">Creados Por Usuario...</MenuItem>
    </Select>
    </Box>
    <Box>
      <Button sx={{ minWidth: 200, }} className="clearFilters" onClick={handleClearFilters}>Clear Filters</Button>
    </Box>
  </Box>

        <Cardsw books={libros} />
        <Pagination
          currentPage={currentPage}
          totalBooks={totalLibros}
          librosPorPagina={librosPorPagina}
          onPageChange={handlePageChange}
        />
        <Footer />
      </Container>
    );
=======
 const flagNav = useSelector((state) => state.flagNav);
 const generonav =  useSelector((state) => state.generonav);
 const titulonav =  useSelector((state) => state.titulonav);
 const dispatch = useDispatch();
 const libros = useSelector(state => state.libros); 
 const librosxpag = 4;
 
 useEffect(() => {
    if (flagNav === "0") (dispatch(obtener_Todos_Libros(1, librosxpag)));
    if (flagNav === "1") (dispatch(librosGenero(1,generonav,librosxpag)));
    if (flagNav === "2") (dispatch(librosPorTitulo(1,titulonav,librosxpag)));
}, [ flagNav, generonav,titulonav ]);

const handlePageChange = (pageNumber) => {
   if (flagNav === "0") (dispatch(obtener_Todos_Libros(pageNumber, librosxpag)));
   if (flagNav === "1") (dispatch(librosGenero(pageNumber,generonav,librosxpag)));
   if (flagNav === "2") (dispatch(librosPorTitulo(pageNumber,titulonav,librosxpag)))

};


 return (
 <div className="home-page">
   {/* <NavBar /> */}
   <div className="container mt-5">
     <h1>Lista de Libros</h1>
     <Cardsw books={libros.libros} />
    <Pagination
      libros={libros} 

      onPageChange={handlePageChange}
    />
   </div>   
   <Footer />
 </div>
);
>>>>>>> aad8582fcf1e22130e9adf4e3becb76bafdeb7d3
};

export default Home;


-------------------------------------------------------



import React, { useEffect, useState } from 'react';
import { useDispatch, useSelector } from "react-redux";
import { Box, Button, Select, Container, Typography, Autocomplete, TextField, Grid, FormControl, OutlinedInput, MenuItem,   } from '@mui/material';
import './Home.css'
import Pagination from '../Paginate/Paginate';
import { obtener_Todos_Libros } from '../../redux/actions/actions';
import Cardsw from '../Cards/Cardsw';
import Footer from './../Footer/Footer';

const Home = () => {
 const dispatch = useDispatch();
 const todoLibros = useSelector((state) => state.libros);
 const [libros, setLibros] = useState([]);
 const [currentPage, setCurrentPage] = useState(1);
 const librosPorPagina = 12;
 const [totalLibros, setTotalLibros] = useState();

 const [selectedGenre, setSelectedGenre] = useState(null);
 const [genres, setGenres] = useState([]);
 const [uniqueGenres, setUniqueGenres] = useState([]); 

 const [selectedAuthor, setSelectedAuthor] = useState(null);
 const [authors, setAuthors] = useState([]);
 const [uniqueAuthors, setUniqueAuthors] = useState([]);

 const [ordenPrecio, setOrdenPrecio] = useState('');
 const [uniquePrices, setUniquePrices] = useState([]);
 const opcionesPrecio = ordenPrecio === 'descendente' ? uniquePrices.descendente : uniquePrices.ascendente;


 const indexOfLastBook = currentPage * librosPorPagina;
 const indexOfFirstBook = indexOfLastBook - librosPorPagina;
 const currentBooks = Array.isArray(libros) ? libros.slice(indexOfFirstBook, indexOfLastBook) : [];


 useEffect(() => {
  dispatch(obtener_Todos_Libros(currentPage, librosPorPagina));
}, [currentPage,dispatch]);

useEffect(() => {
 if (todoLibros && todoLibros.libros) {
   setLibros(todoLibros.libros);
   setTotalLibros(todoLibros.totalLibros);

   if (Array.isArray(todoLibros.libros)) {
     const uniqueGenres = [...new Set(todoLibros.libros.map(book => book.nombregenero))];
     setGenres(uniqueGenres);
     setUniqueGenres(uniqueGenres);

     const uniqueAuthors = [...new Set(todoLibros.libros.map(book => book.nombreautor))];
     setAuthors(uniqueAuthors);
     setUniqueAuthors(uniqueAuthors);

      const uniquePricesAsc = [...new Set(todoLibros.libros.map(book => book.preciolibro))];
      const uniquePricesDesc = [...uniquePricesAsc].sort((a, b) => b - a);
      setUniquePrices({ ascendente: uniquePricesAsc, descendente: uniquePricesDesc });

      }
     }
}, [todoLibros]);


const handlePageChange = (pageNumber) => {
    console.log("pageNumber ", pageNumber);
    setCurrentPage(pageNumber);
};

const handleGenreFilter = (event) => {
  setSelectedGenre(event.target.value);
};

const handleAuthorFilter = (event) => {
  setSelectedAuthor(event.target.value);
};

const handlePriceFilter = (event) => {
  setOrdenPrecio(event.target.value);
};

const handleSortAsc = () => {
  setOrdenPrecio('ascendente');
};

const handleSortDesc = () => {
  setOrdenPrecio('descendente');
};


const filteredBooks = libros.filter(book => !selectedGenre || book.nombregenero === selectedGenre);


const filteredBooksByAuthor = filteredBooks.filter(book => !selectedAuthor || book.nombreautor === selectedAuthor);


const filteredBooksByPrice = ordenPrecio
? filteredBooksByAuthor.sort((a, b) => ordenPrecio === 'ascendente' ? a.preciolibro - b.preciolibro : b.preciolibro - a.preciolibro)
: filteredBooksByAuthor;

      
 return (
  <Container component="main" maxWidth="md">
      <Typography variant="h2" align="center" gutterBottom sx={{ mt:10 }}>
         Lista de Libros
         </Typography>
         <Grid container spacing={10} alignItems="center" flexWrap="nowrap">
          <Grid item xs={4}>
            {/* Genero */}
            <FormControl fullWidth>
      <TextField
        id="combo-box-demo"
        select
        label="Género"
        value={selectedGenre}
        onChange={handleGenreFilter}
        SelectProps={{
          native: true,
        }}
      >
        {/* Default Option */}
        <option value="" disabled>
          Género
        </option>

        {/* Options from uniqueGenres array */}
        {uniqueGenres.map((genre) => (
          <option key={genre} value={genre}>
            {genre}
          </option>
        ))}
      </TextField>
    </FormControl>
          </Grid>
          <Grid item xs={4}>
            {/* Autor/a */}
            <Autocomplete
            disablePortal
            id="combo-box-author"
            options={uniqueAuthors}
            sx={{ width: '110%', mb: 8, mt: 8 }}
            onChange={handleAuthorFilter}
            value={selectedAuthor}
            renderInput={(params) => <TextField {...params} label="Autor" />}
          />
          </Grid>
          <Grid item xs={4}>
          {/* Precio */}
          <FormControl sx={{ width: '110%', mb: 8, mt: 8 }}>
            <Select
              value={ordenPrecio}
              onChange={handlePriceFilter}
              displayEmpty
              input={<OutlinedInput />}
              renderValue={(selected) => (selected ? `Órden: ${selected === 'ascendente' ? 'Ascendente' : 'Descendente'}` : 'Ordenar por precio')}
            >
              <MenuItem value=""><em>Ordenar por precio</em></MenuItem>
              <MenuItem value="ascendente" onClick={handleSortAsc}>
                Ascendente
              </MenuItem>
              <MenuItem value="descendente" onClick={handleSortDesc}>
                Descendente
              </MenuItem>
            </Select>
          </FormControl>
        </Grid>
        </Grid>
        <Cardsw books={libros} />
        <Pagination
          currentPage={currentPage} 
          totalBooks={totalLibros} 
          librosPorPagina={librosPorPagina}
          onPageChange={handlePageChange}
        />

        <Footer />
      </Container>
    );
};

export default Home;